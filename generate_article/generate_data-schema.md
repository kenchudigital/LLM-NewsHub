# Generate Data Schema Documentation

This document describes the schema for the data files generated by `generate_data.py` in the `data/group/{date}/` directory.

## Overview

The `generate_data.py` script creates four main CSV files by extracting and filtering data from source files based on event and post IDs from a group result file. The generated files are:

1. `events_df.csv` - Event data from event cards
2. `posts_df.csv` - Post data from Reddit posts
3. `comments_df.csv` - Comment data from Reddit comments
4. `articles_df.csv` - Article data from fundus news articles

## File: events_df.csv

**Source**: `data/card/event_card/{date}.csv`

**Description**: Contains event information extracted from event cards, filtered by event IDs from the group result.

### Schema

| Column | Type | Description |
|--------|------|-------------|
| `event_type` | string | Type/category of the event (e.g., "sports", "political", "cultural") |
| `event_description` | string | Detailed description of the event |
| `event_date` | string | Date of the event (YYYY-MM-DD format) |
| `event_time` | string | Time of the event (HH:MM:SS format) or "Empty" |
| `event_location` | string | Location of the event (JSON array format) |
| `event_organizer` | string | Organizer of the event (JSON array format) |
| `event_people_involved` | string | People involved in the event (JSON array format) |
| `event_connections` | string | Related events or connections |
| `statement_or_comment` | string | Associated statement or comment text |
| `statement_source` | string | Source of the statement |
| `statement_source_url` | string | URL of the statement source |
| `image_caption` | string | Caption for associated image |
| `image` | string | Image URL or identifier |

## File: posts_df.csv

**Source**: `data/card/statement_card/posts/{date}.csv`

**Description**: Contains Reddit post data, filtered by post IDs from the group result.

### Schema

| Column | Type | Description |
|--------|------|-------------|
| `post_id` | string | Unique Reddit post identifier |
| `extract_time` | string | Timestamp when data was extracted |
| `source` | string | Source platform (e.g., "Reddit") |
| `topic/subreddit` | string | Subreddit or topic category |
| `title` | string | Post title |
| `content` | string | Post content/body text |
| `category` | string | Content category |
| `language` | string | Language code (e.g., "en") |
| `publish_time_utc` | string | UTC timestamp of post publication |
| `link` | string | URL to the Reddit post |
| `image/video` | string | Associated media URL |
| `ups` | integer | Number of upvotes |
| `upvote_ratio` | float | Ratio of upvotes to total votes |
| `score` | integer | Post score |
| `location` | string | Geographic location |
| `num_comments` | integer | Number of comments |
| `author_id` | string | Reddit user ID |
| `author_name` | string | Reddit username |
| `author_post_karma` | integer | Author's post karma |
| `author_comment_karma` | integer | Author's comment karma |
| `publish_date_utc` | string | Publication date in UTC |
| `title_polarity` | float | Sentiment polarity of title |
| `title_subjectivity` | float | Subjectivity score of title |
| `title_vader_neg` | float | VADER negative sentiment for title |
| `title_vader_neu` | float | VADER neutral sentiment for title |
| `title_vader_pos` | float | VADER positive sentiment for title |
| `title_vader_compound` | float | VADER compound sentiment for title |
| `content_polarity` | float | Sentiment polarity of content |
| `content_subjectivity` | float | Subjectivity score of content |
| `content_vader_neg` | float | VADER negative sentiment for content |
| `content_vader_neu` | float | VADER neutral sentiment for content |
| `content_vader_pos` | float | VADER positive sentiment for content |
| `content_vader_compound` | float | VADER compound sentiment for content |
| `persons` | string | Extracted person names (JSON array) |
| `dates` | string | Extracted dates (JSON array) |
| `organizations` | string | Extracted organization names (JSON array) |
| `locations` | string | Extracted location names (JSON array) |
| `actions` | string | Extracted action verbs (JSON array) |
| `events` | string | Extracted event mentions (JSON array) |
| `location_details` | string | Detailed location information (JSON) |
| `polarity` | float | Overall sentiment polarity |
| `subjectivity` | float | Overall subjectivity score |
| `vader_compound` | float | Overall VADER compound sentiment |
| `engagement_score` | float | Calculated engagement score |
| `author_total_karma` | integer | Total karma of author |
| `author_credibility_score` | float | Author credibility score |
| `real_news_probability` | float | Probability of being real news |
| `fake_news_probability` | float | Probability of being fake news |
| `confidence_score` | float | Confidence score for classification |
| `composite_credibility_score` | float | Composite credibility score |

## File: comments_df.csv

**Source**: `data/card/statement_card/comments/{date}.csv`

**Description**: Contains Reddit comment data, filtered by post IDs from the group result.

### Schema

| Column | Type | Description |
|--------|------|-------------|
| `post_id` | string | Parent post ID |
| `comment_id` | string | Unique comment identifier |
| `extract_time` | string | Timestamp when data was extracted |
| `comment_body` | string | Comment text content |
| `category` | string | Content category |
| `language` | string | Language code (e.g., "en") |
| `comment_created_utc` | string | UTC timestamp of comment creation |
| `comment_permalink` | string | URL to the comment |
| `media_links` | string | Associated media links (JSON array) |
| `comment_ups` | integer | Number of upvotes |
| `comment_score` | integer | Comment score |
| `location` | string | Geographic location |
| `commenter_name` | string | Reddit username |
| `commenter_id` | string | Reddit user ID |
| `commenter_post_karma` | float | Commenter's post karma |
| `commenter_comment_karma` | float | Commenter's comment karma |
| `comment_parent_id` | string | Parent comment ID |
| `publish_date_utc` | string | Publication date in UTC |
| `polarity` | float | Sentiment polarity |
| `subjectivity` | float | Subjectivity score |
| `vader_neg` | float | VADER negative sentiment |
| `vader_neu` | float | VADER neutral sentiment |
| `vader_pos` | float | VADER positive sentiment |
| `vader_compound` | float | VADER compound sentiment |
| `persons` | string | Extracted person names (JSON array) |
| `dates` | string | Extracted dates (JSON array) |
| `organizations` | string | Extracted organization names (JSON array) |
| `locations` | string | Extracted location names (JSON array) |
| `actions` | string | Extracted action verbs (JSON array) |
| `events` | string | Extracted event mentions (JSON array) |
| `location_details` | string | Detailed location information (JSON) |
| `controversy_score` | float | Controversy score |
| `engagement_score` | float | Engagement score |
| `real_news_probability` | float | Probability of being real news |
| `fake_news_probability` | float | Probability of being fake news |
| `confidence_score` | float | Confidence score for classification |

## File: articles_df.csv

**Source**: `data/raw/fundus/{date}/*.csv`

**Description**: Contains news article data from fundus sources, filtered by URLs from events.

### Schema

| Column | Type | Description |
|--------|------|-------------|
| `title` | string | Article title |
| `content` | string | Article content/body text |
| `topic` | string | Article topics (JSON array) |
| `publish_time` | string | UTC timestamp of publication |
| `link` | string | Article URL |
| `publisher` | string | Publisher name |
| `publisher_country` | string | Publisher's country code |
| `language` | string | Article language code |
| `media_links` | string | Associated media links (JSON array) |
| `extract_time` | string | Timestamp when data was extracted |
| `word_count` | integer | Number of words in article |
| `url_category` | string | URL category |
| `url_sub_category` | string | URL sub-category |
| `url_domain` | string | Domain of the URL |
| `publish_date` | string | Publication date (YYYY-MM-DD format) |

## Data Flow

1. **Input**: The script reads `group_result.csv` from `data/group/{date}/` to get event and post IDs
2. **Filtering**: It filters source data files based on these IDs
3. **Output**: Creates four CSV files in `data/group/{date}/`:
   - `events_df.csv` - Events matching the group's event IDs
   - `posts_df.csv` - Posts matching the group's post IDs  
   - `comments_df.csv` - Comments for posts matching the group's post IDs
   - `articles_df.csv` - Articles with URLs matching the group's event URLs

## Usage

```bash
python generate_article/generate_data.py --date YYYY-MM-DD
```

The script will generate all four files for the specified date, or use today's date if no date is provided.

## Notes

- All JSON fields are stored as strings and need to be parsed using `ast.literal_eval()` or `json.loads()`
- Some fields may contain "Empty" values for missing data
- The script creates the output directory if it doesn't exist
- If no articles are found for the event URLs, `articles_df.csv` will not be created
